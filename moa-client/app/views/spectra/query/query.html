<form role="form" name="querySpectraDialog" novalidate>
    <div class="modal-header">
        <button type="button" class="close" ng-click="cancelDialog()" aria-hidden="true">Ã—</button>
        <h3 class="modal-title">Query Spectra</h3>

        <div><p>Below are all querieable options for our mass spectral database. You may fill in as many or as few fields as desired.</p></div>
    </div>

    <div class="modal-body">
        <accordion close-others="false">
            <accordion-group is-open="queryAccordion.name">
                <accordion-heading><div>Query by Name</div></accordion-heading>

                <div class="form-group">
                    <label class="control-label" for="nameFilter">Partial filtering by compound name:</label>
                    <input id="nameFilter"
                           name="nameFilter"
                           ng-model="query.nameFilter"
                           placeholder="Name"
                           class="form-control"/>
                </div>
            </accordion-group>


            <accordion-group is-open="queryAccordion.inchikey">
                <accordion-heading><div>Query by InChIKey</div></accordion-heading>

                <div class="form-group">
                    <label class="control-label" for="inchiFilter">Partial filtering by biological or compound
                        InChIKey:</label>
                    <input id="inchiFilter"
                           name="inchiFilter"
                           ng-model="query.inchiFilter"
                           placeholder="InChIKey"
                           ng-pattern="/^([A-Z,0-9,\-]+)+$/"
                           class="form-control"/>
                </div>
            </accordion-group>


            <accordion-group is-open="queryAccordion.accurateMass">
                <accordion-heading><div>Query by Accurate Mass</div></accordion-heading>

                <div class="form-group">
                    <label class="control-label col-sm-4" for="accurateMass">Mass:</label>

                    <div class="col-sm-8">
                        <input id="accurateMass"
                               name="accurateMass"
                               ng-model="query['Mz_exact']"
                               placeholder="Accurate Mass"
                               class="form-control"/>
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label col-sm-4" for="accurateMassTolerance">Tolerance (&pm;):</label>

                    <div class="col-sm-8">
                        <input id="accurateMassTolerance"
                               name="accurateMassTolerance"
                               ng-model="query['Mz_exact_tolerance']"
                               placeholder="Accurate Mass Tolerance"
                               class="form-control"/>
                    </div>
                </div>
            </accordion-group>


            <accordion-group is-open="queryAccordion.tags">
                <accordion-heading><div>Query by Tags</div></accordion-heading>

                <div class="form-group">
                    <label for="tags-select" class=" control-label">Filter by Tags:</label>

                    <select id="tags-select"
                            name="tags-select"
                            class="form-control"
                            data-placeholder="Select Tags"
                            ng-model="tagsSelection"
                            ng-options="tag.text for tag in tags"
                            ng-multiple="true"
                            multiple
                            multiselect-dropdown></select>
                </div>
            </accordion-group>


            <accordion-group is-open="queryAccordion.metadata">
                <accordion-heading><div>Query by Metadata</div></accordion-heading>

                <fieldset ng-repeat="(k, v) in metadata">
                    <legend>{{k == "none" ? "General" : k}}</legend>

                    <div class="form-group" ng-repeat="meta in v | unique:'name'">
                        <div ng-if="meta.type == 'double'">
                            <label class="control-label col-sm-4" for="meta_{{meta.id}}">{{meta.name}}</label>

                            <div class="col-sm-5">
                                <input id="meta_{{meta.id}}"
                                       name="{{meta.name}}"
                                       ng-model="query[meta.name]"
                                       class="form-control"/>
                            </div>

                            <label class="control-label col-sm-1" for="{{meta.name}}_tolerance">&pm;</label>

                            <div class="col-sm-2">
                                <input id="{{meta.name}}_tolerance"
                                       name="{{meta.name}}_tolerance"
                                       ng-model="query[meta.name +'_tolerance']"
                                       class="form-control"/>
                            </div>
                        </div>

                        <div ng-if="meta.type == 'string'">
                            <label class="control-label col-sm-4" for="meta_{{meta.id}}">{{meta.name}}</label>

                            <div class="col-sm-8">
                                <input type="text"
                                       id="meta_{{meta.id}}"
                                       name="{{meta.name}}"
                                       ng-model="query[meta.name]"
                                       typeahead="x for x in queryMetadataValues(meta.name, $viewValue)"
                                       class="form-control" />
                            </div>
                        </div>

                        <div ng-if="meta.type == 'boolean'">
                            <label class="control-label col-sm-4" for="meta_{{meta.id}}">{{meta.name}}</label>

                            <div class="col-sm-8">
                                <input id="meta_{{meta.id}}"
                                       name="{{meta.name}}"
                                       ng-model="query[meta.name]"
                                       class="form-control"/>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </accordion-group>
        </accordion>

        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-click="submitQuery()">Submit query to system</button>
        <button class="btn btn-warning" ng-click="cancelDialog()">Close</button>
    </div>
</form>

